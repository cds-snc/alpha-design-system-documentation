{"version":3,"file":"gcds-error-summary.js","sourceRoot":"","sources":["../../../src/components/gcds-error-summary/gcds-error-summary.tsx"],"names":[],"mappings":"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","sourcesContent":["import {\n  Component,\n  Host,\n  Element,\n  Prop,\n  Watch,\n  State,\n  Listen,\n  h,\n} from '@stencil/core';\nimport { assignLanguage, observerConfig } from '../../utils/utils';\nimport i18n from './i18n/i18n';\n\n@Component({\n  tag: 'gcds-error-summary',\n  styleUrl: 'gcds-error-summary.css',\n  shadow: true,\n})\nexport class GcdsErrorSummary {\n  @Element() el: HTMLElement;\n\n  private shadowElement?: HTMLElement;\n\n  /**\n   * Set error summary heading\n   */\n  @Prop({ reflect: true }) heading?: string;\n\n  /**\n   * Specifies if the error summary should listen for GcdsError event to generate error list.\n   */\n  @Prop({ mutable: true }) listen?: boolean = true;\n  @Watch('listen')\n  listenChanged() {\n    if (this.errorLinks) {\n      this.listen = false;\n    }\n  }\n\n  /**\n   * Object of list items for error list. Format: { link-href: link-label }\n   */\n  @Prop({ reflect: false, mutable: true }) errorLinks: string | object;\n  errorLinksObject: object = {};\n\n  /**\n   * Convert contextual links prop to object\n   * (Object props get treated as string when using Stencil components without a framework)\n   */\n  @Watch('errorLinks')\n  errorLinksChanged(newErrorLinks: string | object) {\n    if (typeof newErrorLinks == 'string') {\n      this.errorLinks = JSON.parse(newErrorLinks);\n    } else if (typeof newErrorLinks == 'object') {\n      this.errorLinks = newErrorLinks;\n    }\n\n    // Turn off listen if error-links is being used\n    if (this.listen) {\n      this.listen = false;\n    }\n  }\n\n  /**\n   * Language of rendered component\n   */\n  @State() lang: string;\n\n  /**\n   * Queue of erros\n   */\n  @State() errorQueue: object = {};\n\n  @State() hasSubmitted: boolean = false;\n\n  @Listen('gcdsError', { target: 'document' })\n  errorListener(e) {\n    if (this.listen && e.target.closest('form') == this.el.closest('form')) {\n      this.errorLinksObject[e.detail.id] = e.detail.message;\n    }\n  }\n\n  @Listen('gcdsValid', { target: 'document' })\n  validListener(e) {\n    if (this.listen && e.target.closest('form') == this.el.closest('form')) {\n      if (this.errorLinksObject && this.errorLinksObject[e.detail.id]) {\n        delete this.errorLinksObject[e.detail.id];\n      }\n\n      if (this.errorQueue) {\n        const sortedErrorList = this.sortErrors();\n\n        this.errorQueue = { ...sortedErrorList };\n      }\n    }\n  }\n\n  @Listen('submit', { target: 'document' })\n  submitListener(e) {\n    if (this.listen && e.target.closest('form') == this.el.closest('form')) {\n      this.hasSubmitted = true;\n\n      // Time out to collect gcdsError events before rendering\n      setTimeout(() => {\n        const sortedErrorList = this.sortErrors();\n\n        this.errorQueue = { ...sortedErrorList };\n\n        // Time out to let list render\n        setTimeout(() => {\n          this.shadowElement.focus();\n        }, 50);\n      }, 100);\n    }\n  }\n\n  /*\n   * Sort error object based on the order form compoennts appear in the form\n   */\n  sortErrors() {\n    const sortable = [];\n    for (const id in this.errorLinksObject) {\n      sortable.push([\n        id,\n        this.errorLinksObject[id],\n        document.querySelector(id).getBoundingClientRect().y,\n      ]);\n    }\n\n    sortable.sort(function (a, b) {\n      return a[2] - b[2];\n    });\n\n    const objSorted = {};\n    sortable.forEach(function (item) {\n      objSorted[item[0]] = item[1];\n    });\n\n    return objSorted;\n  }\n\n  /*\n   * Focus element on error link click with label visible\n   */\n  focusElement(event, id) {\n    event.preventDefault();\n\n    const element = document.querySelector(id);\n\n    let target = `[for=${id.replace('#', '')}]`;\n\n    if (element.nodeName == 'FIELDSET') {\n      target = `#legend-${id.replace('#', '')}`;\n    }\n\n    element.closest('form').querySelector(target).scrollIntoView();\n    element.focus();\n  }\n\n  /*\n   * Observe lang attribute change\n   */\n  updateLang() {\n    const observer = new MutationObserver(mutations => {\n      if (mutations[0].oldValue != this.el.lang) {\n        this.lang = this.el.lang;\n      }\n    });\n    observer.observe(this.el, observerConfig);\n  }\n\n  async componentWillLoad() {\n    // Define lang attribute\n    this.lang = assignLanguage(this.el);\n\n    this.updateLang();\n    this.listenChanged();\n\n    // Format error-links string / object\n    if (this.errorLinks && typeof this.errorLinks == 'string') {\n      this.errorQueue = { ...JSON.parse(this.errorLinks) };\n    } else if (this.errorLinks && typeof this.errorLinks == 'object') {\n      this.errorQueue = { ...this.errorLinks };\n    }\n  }\n\n  render() {\n    const { heading, errorQueue, lang, hasSubmitted, errorLinks } = this;\n    return (\n      <Host>\n        <div\n          role=\"alert\"\n          tabindex=\"-1\"\n          ref={element => (this.shadowElement = element as HTMLElement)}\n          class={`gcds-error-summary ${\n            (hasSubmitted || errorLinks) && Object.keys(errorQueue).length > 0\n              ? 'gcds-show'\n              : ''\n          }`}\n        >\n          <h2 class=\"summary__heading\">{heading ?? i18n[lang].heading}</h2>\n          <ol class=\"summary__errorlist\">\n            {(hasSubmitted || errorLinks) &&\n              Object.keys(errorQueue).length > 0 &&\n              Object.keys(errorQueue).map(key => {\n                return (\n                  <li class=\"summary__listitem\">\n                    <a\n                      onClick={e => this.focusElement(e, key)}\n                      class=\"summary__link\"\n                      href={key}\n                    >\n                      {errorQueue[key]}\n                    </a>\n                  </li>\n                );\n              })}\n          </ol>\n        </div>\n      </Host>\n    );\n  }\n}\n"]}